<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>提交</title>
    <link rel="stylesheet" href="../css/bootstrap.css">
    <style>
        .img {
            width: 100px;
        }

        .uploadImg {
            position: relative;
        }

        .upload {
            width: 100px;
            height: 100px;
            border: 1px solid #eee;
            position: absolute;
            opacity: 0;
        }
    </style>
</head>

<body>
    <header id="header"></header>
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-md-offset-3">
                <h1 class="page-header">写文章</h1>
                <form role="form" id="postNews">
                    <div class="form-group">
                        <div class="title">
                            <label for="name">名称</label>
                            <select name="type" id="typeName">
                                <option value="动漫">
                                    动漫
                                </option>
                                <option value="国漫">
                                    国漫
                                </option>
                            </select>
                        </div>
                        <input type="text" class="form-control" name="title" placeholder="请输入名称">
                    </div>

                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-6">
                                <div>
                                    <input type="file" class="upload" id="uploadImg" name="url" placeholder="上传图片">
                                    <img src="./img/upload.png" alt="" class="img" id="imgUrl">
                                    <input type="hidden" id="hidden">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="">内容</label>
                        <textarea class="form-control" name="body" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <div class="row">
                            <div class="col-md-4">
                                <label for="name">发布者</label>
                                <input type="text" class="form-control" name="username" placeholder="作者">
                            </div>
                            <div class="col-md-4">
                                <label for="name">发布时间</label>
                                <input type="datetime-local" class="form-control" name="ctime" placeholder="时间">
                            </div>
                            <div class="col-md-4">
                                <label for="name">发布者的城市</label>
                                <input type="text" class="form-control" name="city" placeholder="城市">
                            </div>
                        </div>
                    </div>
                    <div id="myAlert">
                        <a href="#" class="close" data-dismiss="alert">&times;</a> 
                    </div>
                    <button type="submit" class="btn btn-default">提交</button>
                </form>
            </div>
        </div>
    </div>


    <script src="../js/jquery.js"></script>
    <script src="../js/bootstrap.js"></script>
    <script src="../js/header.js"></script>

    <script>
        $("#uploadImg").change(function () {
            let file = $(this)[0].files[0]
            let reader = new FileReader()
            reader.onload = function () {
                $('#hidden').val(this.result)
                $('#imgUrl')[0].src = this.result
                var sub=this.result.substring(this.result.indexOf(','))
            }
            reader.readAsDataURL(file)
        })
        $('#postNews').on('submit', function (e) {
            e.preventDefault();
            $.post('http://api.hzbiz.net/0103/api/postNews.php ', {
                title: $('[name="title"]').val(),
                body: $('[name="body"]').val(),
                ctime: $('[name="ctime"]').val(),
                city: $('[name="city"]').val(),
                username: $('[name="username"]').val(),
                url: $('#hidden').val(),
                type: $('[name="type"]').val(),
            }, function (res) {
                console.log(res)
                if(res.isCheck){
                    $('#myAlert').addClass('alert alert-success')
                    $('#myAlert').html('<strong>'+res.msg+'</strong>')
                    setInterval(function () { 
                        location.href='./index.html'
                     },5000)
                }
            },'json')
        })
        $.get('http://api.hzbiz.net/0103/api/typeClass.php', function (res) {
               var valueClass=JSON.parse(res)
            $.each(valueClass.typeClass, function (index, value) {
                var tr = `
                <option value="动漫"></option>  
                <option value="${value.typeclass}">${value.typeclass}</option>   
        </tr>     `
            $('#typeName').append(tr)
            })
        })
    </script>
</body>

</html>